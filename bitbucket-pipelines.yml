image: amazon/aws-cli

pipelines:
  default:
    - step:
        oidc: true
        script:
          
          - export AWS_WEB_IDENTITY_TOKEN_FILE=$(pwd)/web-identity-token
          - echo $BITBUCKET_STEP_OIDC_TOKEN > $(pwd)/web-identity-token
          - echo $AWS_REGION
          - echo AWS_ROLE_ARN
          
          # Install p7zip using yum
          - echo "Installing zip..."
          - if ! command -v zip &> /dev/null; then yum install -y zip; fi
          
          # Run deploy.sh script for deployment
          - chmod +x deploy.sh
          - ./deploy.sh  # This runs the deploy script, which handles all AWS deployment tasks

        artifacts:
          - backend/lambda/visitor_counter.zip